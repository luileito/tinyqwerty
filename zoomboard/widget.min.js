/*! tinyqwerty ZoomBoard keyboard 2016-05-20 */!function(a,b){if(a.jQuery===b)throw new Error("This demo requires jQuery.");var c=require("../common/log.min");c.config({saveUrl:"save.php"});var d={options:{img_srcs:["zb-main.png","zb-symbols.png"],keymaps:[keys,keys_sym],keyboard_names:["ZB","#"],zoom_factor:2.2,max_taps:2,num_taps:1,original_scale:.15,max_zoom:1,reset_on_max_zoom:!0,reset_time:1,anim_time:.1,min_swipe_x:40,min_swipe_y:30,center_bias:.05,max_key_error_distance:2,use_real_keyboard:!0},swipeKey:{LEFT:"<left>",RIGHT:"<right>",UP:"<up>",DOWN:"<down>"},actionKey:{ENTER:"<enter>",DELETE:"<delete>",SPACE:" "},cursorPos:function(a){var b=a.originalEvent,c={x:b.pageX,y:b.pageY};if(b.touches||b.changedTouches){var d=b.touches[0]||b.changedTouches[0];c.x=d.pageX,c.y=d.pageY}return c},_create:function(){var a=this;$.Widget.prototype._create.call(this),this.flash=a.flash,this.actionKey=a.actionKey,this.num_taps=1,this.original_position={x:0,y:0,width:0,height:0},this.original_dimensions={width:0,height:0},this.img=$("<img />").appendTo(this.element).css({position:"absolute",left:"0px",top:"0px","pointer-events":"none","-webkit-transition":"all "+this.option("anim_time")+"s ease-out"}).on("load",function(){a.original_dimensions.width=a.img[0].naturalWidth,a.original_dimensions.height=a.img[0].naturalHeight,a.reset()}),this.img.on("load",$.proxy(function(){setTimeout($.proxy(function(){this.overlay.css("font-size",this.img.height()/1.2+"px")},this),500)},this)),this.overlay=$("<div />").appendTo(this.element).addClass("overlay").css({height:"100%",width:"100%",position:"absolute","pointer-events":"none","-webkit-transition":"opacity 0.2s ease-in-out",color:"white","text-align":"center","font-size":this.img.height()/1.2+"px","text-shadow":"0px 0px 4px #000","background-color":"rgba(0,0,0,0.4)","font-family":"sans-serif",opacity:0,"text-transform":"capitalize","line-height":"normal"}),this.element.css({position:"relative",overflow:"hidden"}),this.element.on("touchstart.zoomboard_swipe mousedown.zoomboard_swipe",function(b){var d=!1;if(a.in_starting_position){d=!0;var e=a.cursorPos(b),f=function(){d=!1,a.element.off("touchmove.zb_swipe touchend.zb_swipe mousemove.zb_swipe mouseup.zb_swipe")};a.element.on("touchmove.zb_swipe mousemove.zb_swipe",function(b){if(d===!0){var g=a.cursorPos(b);c.register(c.event.MOVE,g);var h=e.x-g.x,i=e.y-g.y;Math.abs(h)>=a.option("min_swipe_x")?h>0?(a.on_swipe(a.swipeKey.LEFT),f(),a.just_gestured=!0):(a.on_swipe(a.swipeKey.RIGHT),f(),a.just_gestured=!0):Math.abs(i)>=a.option("min_swipe_y")&&(i>0?(a.on_swipe(a.swipeKey.UP),f(),a.just_gestured=!0):(a.on_swipe(a.swipeKey.DOWN),f(),a.just_gestured=!0))}}),a.element.on("touchend.zb_swipe mouseup.zb_swipe",f)}}),this.element.on("touchstart.zoomboard mousedown.zoomboard",_.bind(this.on_element_click,this)),this.option("use_real_keyboard")&&($(document).keypress(function(b){b.preventDefault();var c=b.keyCode||b.which,d=$.Event("zb_key");d.key=String.fromCharCode(c).toLowerCase(),a.is_printable(b)&&a.element.trigger(d)}),$(document).keydown(function(b){var c=b.keyCode||b.which;if(37===c)a.on_swipe(a.swipeKey.LEFT);else if(39===c)a.on_swipe(a.swipeKey.RIGHT);else if(38===c)a.on_swipe(a.swipeKey.UP);else if(40===c)a.on_swipe(a.swipeKey.DOWN);else{var d=$.Event("zb_key");8===c?(b.preventDefault(),d.key=a.actionKey.DELETE):13===c&&(d.key=a.actionKey.ENTER),a.element.trigger(d)}})),this.reset_timeout=b,this.set_keyboard_index(0),this.in_starting_position=!0,this.just_gestured=!1},destroy:function(){this.img.remove(),this.element.css({position:"",overflow:""}),this.element.off("touchstart.zoomboard mousedown.zoomboard"),this.option("use_real_keyboard")&&$(document).removeAttr("keypress").removeAttr("keydown"),$.Widget.prototype.destroy.call(this)},is_printable:function(a){return typeof a.which===b?!0:"number"==typeof a.which&&a.which>0?!a.ctrlKey&&!a.metaKey&&!a.altKey&&8!=a.which:!1},set_keyboard_index:function(a){var b=this.option("img_srcs")[a],d=this.option("keymaps")[a],e=this.option("keyboard_names")[a];this.img.attr("src",b),this.keymap=d,this.keyboard_index=a,this.flash(e,500,"#7A9FC4"),c.register(c.event.LOAD,a)},get_keyboard_index:function(){return this.keyboard_index},get_num_keyboards:function(){return this.option("img_srcs").length},on_swipe:function(a){c.register(c.event.SWIPE,a);var b=$.Event("zb_swipe");if(b.direction=a,this.element.trigger(b),this.reset(!1),a===this.swipeKey.LEFT){var d=$.Event("zb_key");d.key=this.actionKey.DELETE,this.element.trigger(d)}else if(a===this.swipeKey.RIGHT){var d=$.Event("zb_key");d.key=this.actionKey.SPACE,this.element.trigger(d)}else if(a===this.swipeKey.UP){var e=this.get_keyboard_index(),f=this.get_num_keyboards();e++,e>=f&&(e=0),this.set_keyboard_index(e)}else if(a===this.swipeKey.DOWN){var e=this.get_keyboard_index();if(e--,0>e){var f=this.get_num_keyboards();e=f-1}this.set_keyboard_index(e)}},do_zoom:function(a,b){var d=(this.get_zoom(),this.option("zoom_factor")),e=this.option("center_bias"),f=(this.option("max_zoom"),this.option("max_taps")),g=$.Event("zb_zoom");if(g.x=a,g.y=b,this.element.trigger(g),this.num_taps==f){var h=this.get_key_for_point({x:a,y:b});if(null!==h){var i=$.Event("zb_key");i.key=h.key,this.element.trigger(i)}return void this.reset()}c.register(c.event.ZOOM_IN),this.num_taps++,this.in_starting_position=!1;var j=this.viewport.width/d,k=this.viewport.height/d,l=a-j/2,m=b-k/2,n=a-j*(a-this.viewport.x)/this.viewport.width,o=b-k*(b-this.viewport.y)/this.viewport.height;this.set_viewport({width:j+5,height:k,x:n*(1-e)+l*e,y:o*(1-e)+m*e})},on_element_click:function(a){a.preventDefault(),this.clear_reset_timeout(),c.register(c.event.PRESS,this.cursorPos(a)),$(this.element).one("touchend mouseup",$.proxy(function(a){if(c.register(c.event.RELEASE,this.cursorPos(a)),a.preventDefault(),this.just_gestured===!0)return void(this.just_gestured=!1);if(a.originalEvent.touches){var b=this.cursorPos(a),d=this.element.offset();x=b.x-d.left,y=b.y-d.top}else x=a.offsetX,y=a.offsetY;x=x/this.get_x_zoom()+this.viewport.x,y=y/this.get_y_zoom()+this.viewport.y,this.do_zoom(x,y),this.reset_reset_timeout()},this))},set_viewport:function(a,b){var c=this.get_window_dimensions(),d=c.width/a.width,e=c.height/a.height,f=d*this.original_dimensions.width,g=e*this.original_dimensions.height,h=-a.x*d,i=-a.y*e;this.set_position({x:h,y:i,width:f,height:g},b),this.viewport=a},get_window_dimensions:function(){var a=this.option("original_scale");return{width:this.original_dimensions.width*a,height:this.original_dimensions.height*a}},set_position:function(a,b){b===!1&&(this.img.css("-webkit-transition","none"),this.img.css("-webkit-transition","all 0.001s ease-out")),this.img.css({left:a.x+"px",top:a.y+"px",width:a.width+"px",height:a.height+"px"}),this.position=a,b===!1&&this.img.css("-webkit-transition","all "+this.option("anim_time")+"s ease-out")},reset:function(a){c.register(c.event.ZOOM_OUT),a||(this.num_taps=1),this.set_viewport({x:0,y:0,width:this.original_dimensions.width,height:this.original_dimensions.height},a===!0),this.clear_reset_timeout(),this.in_starting_position=!0},get_center_of_position:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},get_x_zoom:function(){return this.position.width/this.original_dimensions.width},get_y_zoom:function(){return this.position.height/this.original_dimensions.height},get_zoom:function(){return Math.max(this.get_x_zoom(),this.get_y_zoom())},get_key_for_point:function(a){for(var b=this.keymap,c=!1,d=null,e=Math.pow(this.option("max_key_error_distance"),2),f=0,g=b.length;g>f;f++){var h=b[f];if(h.x<=a.x&&h.y<=a.y&&h.x+h.width>=a.x&&h.y+h.height>=a.y)return h;var i=h.x+h.width/2,j=h.y+h.height/2,k=a.x-i,l=a.y-j,m=Math.pow(k,2)+Math.pow(l,2);(null===d||c>m)&&m<e*Math.pow(Math.min(h.width,h.height),2)&&(c=m,d=h)}return d},clear_reset_timeout:function(){this.reset_timeout!==b&&window.clearTimeout(this.reset_timeout),this.reset_timeout=b},reset_reset_timeout:function(){this.clear_reset_timeout();var a=1e3*this.option("reset_time");this.reset_timeout=window.setTimeout(_.bind(this.reset,this),a)},flash:function(a,b,c){b=b||250,c=c||"white",window.clearTimeout(this.flash_timeout),this.overlay.css({opacity:.95,color:c}).html(a),this.flash_timeout=window.setTimeout($.proxy(function(){this.overlay.css("opacity",0)},this),b)},flashkey:function(a){switch(a){case this.actionKey.DELETE:this.flash("&#8656;");break;case this.actionKey.ENTER:this.flash("&#8629;");break;case this.actionKey.SPACE:this.flash("&#9251;");break;default:this.flash(a)}}};$.widget("ui.zoomboard",d)}(this);